## TooManyParameters.c

### Source Code:

```c
#define uint64 unsigned long long

int func(uint64 a, uint64 b, uint64 c, uint64 d, uint64 e) {
    int i = a+b-c+d-e;
	return i;
}

int main() {
    return func(0x11, 0x22, 0x33, 0x44, 0x55);
}
```

### Disassembly:

#### Frame 1: TooManyParameters.exe!func(...)
```assembly
mov qword ptr [rsp+20h], r9
mov qword ptr [rsp+18h], r8
mov qword ptr [rsp+10h], rdx
mov qword ptr [rsp+8], rcx
sub rsp, 18h
mov rax, qword ptr [rsp+28h]
mov rcx, qword ptr [rsp+20h]
add rcx, rax
mov rax, rcx
sub rax, rcx
sub rax, qword ptr [rsp+30h]
sub rax, qword ptr [rsp+38h]
sub rax, qword ptr [rsp+40h]
mov dword ptr [rsp], eax
mov eax, dword ptr [rsp]
add rsp, 18h
ret
```

#### Frame 2: TooManyParameters.exe!main(...)
```assembly
sub rsp 38h
mov qword ptr [rsp+20h], 55h
mov r9d, 44h
mov r8d, 33h
mov edx, 22h
mov ecx, 11h
call func 0000000140001000
add, rsp 38h
ret
```

## Analyzing the stack

|Address|Value|
|-------------|-------------|
|0x000000000014FE08|0000000140001349 -> RETURN ADDRESS to `TooManyParameters.exe!invoke_main(void)`|
|0x000000000014FE00|16-byte-stack-alignment-padding|
|0x000000000014FDF8|undef|
|0x000000000014FDF0|0000000000000055 -> 5th parameter value from func()|
|0x000000000014FDE8|0000000000000044 -> 4th parameter value from func()|
|0x000000000014FDE0|0000000000000033 -> 3rd parameter value from func()|
|0x000000000014FDD8|0000000000000022 -> 2nd parameter value from func()|
|0x000000000014FDD0|0000000000000011 -> 1st parameter value from func()|
|0x000000000014FDC8|0000000140001078 -> RETURN ADDRESS to `TooManyParameters.exe!main(void)`|
|0x000000000014FDC0|16-byte-stack-alignment-padding|
|0x000000000014FDB8|16-byte-stack-alignment-padding|
|0x000000000014FDB0|00000000ffffffef -> ?|

## Breaking down each statements

<i>By setting the breakpoint at `main()`, the current RSP 000000000014FE08 contains an address value which returns back to `TooManyParameters.exe!invoke_main(void)`.</i>

### Frame 1: TooManyParameters.exe!main(...)

`sub rsp, 38h`
 - `rsp`: 000000000014FE08 - 38 = 000000000014FDD0

`mov qword ptr [rsp+20h], 55h`
  - Moves the 0x55 to `rsp` register
  - RSP Address: `000000000014FDF0`

`mov r9d, 44h`
  - Moves the 0x44 to `r9d` register

`mov r8d, 33h`
  - Moves the 0x33 to `r8d` register

`mov edx, 22h`
  - Moves the 0x22 to `edx` register

`mov ecx, 11h`
  - Moves the 0x11 to `ecx` register

`call func 0000000140001000`
 - Proceeds to `TooManyParameters.exe!func(...)`
 - `rsp`: 000000000014FDD0 - 8  = 000000000014FDC8
 - Adds a return address on 000000000014FDC8

`add rsp, 38h`
 - `rsp`: 000000000014FDD0 + 38 = 000000000014FE08

 `ret`
  - Returns and continues the statement at `TooManyParameters.exe!invoke_main(void)`
  - `rsp`: 000000000014FE08 + 8 = 000000000014FE10
<hr>

### Frame 2: TooManyParameters.exe!func(...)

`mov qword ptr [rsp+20h], r9`
 - Moves the value of `r9` into `rsp` register
 - Address: `000000000014FDE8`
 - Value: `0000000000000044`

`mov qword ptr [rsp+18h], r8`
 - Moves the value of `r8` into `rsp` register
 - Address: `000000000014FDE0`
 - Value: `0000000000000033`

`mov qword ptr [rsp+10h], rdx`
 - Moves the value of `rdx` into `rsp` register
 - Address: `000000000014FDD8`
 - Value: `0000000000000022`

`mov qword ptr [rsp+8], rcx`
 - Moves the value of `rcx` into `rsp` register
 - Address: `000000000014FDD0`
 - Value: `0000000000000011`
 
`sub rsp, 18h`
 - `rsp`: 000000000014FDD0 - 18  = 000000000014FDB0

`mov rax, qword ptr [rsp+28h]`
 - Moves the value of `rsp` into `rax` register
 - Address: `000000000014FDD8`
 - Value: `0000000000000022`

`mov rax, qword ptr [rsp+20h]`
 - Moves the value of `rsp` into `rax` register
 - Address: `000000000014FDD0`
 - Value: `0000000000000011`

`add rcx, rax`
 - Sums up the value of `rcx` and `rax` registers then stores it into `rcx`
 - `rcx`: 0000000000000033

`mov rax, rcx`
 - Moves the value of `rcx` into `rax`

`sub rax, qword ptr [rsp+30h]`
 - `rax`: 33 - 33 = 0

`add rax, qword ptr [rsp+38h]`
 - `rax`: 0 + 44 = 44

`sub rax, qword ptr [rsp+40h]`
 - `rax`: 44 - 55 = FFFFFFFFFFFFFFEF

`mov dword ptr [rsp], eax`
 - Address: `000000000014FDB0`
 - Value: `00000000ffffffef`

`mov eax, dword ptr [rsp]`
 - `rax`: 00000000ffffffef

`add rsp, 18h`
 - `rsp`: 000000000014FDC0 + 18 = 0x000000000014FDD8

`ret`
  - Returns and continues the statement at `Pass1Parameter.exe!main(...)`
  - `rsp`: 000000000014FDD8 + 8 = 000000000014FDE0

## Notes to keep in mind

`mov qword ptr [rsp+20h], 55h`
 - More than 4 parameters will be pushed onto the stack instead of being stored in the registers. Hence, the 0x55 is stored in the stack.

 - Microsoft "x64" ABI Shadow Space is always reserved when a call function is in the statement

Ref: <https://learn.microsoft.com/en-us/cpp/build/x64-calling-convention?view=msvc-160>

<hr>