## CallASubroutine1.c

### Source Code:

```c
int func() {
	return 0xbeef;
}

int main() {
    func();
	return 0xf00d;
}
```

### Disassembly:

#### Frame 1: CallASubroutine1.exe!func(...)
```assembly
mov eax, 0BEEFh
ret
```

#### Frame 2: CallASubroutine1.exe!main(...)
```assembly
sub rsp 28h
call func (0140001000h)
mov eax, 0F00Dh
add rsp, 28h
ret
```

## Analyzing the stack

<i><b>undef</b> just means that it's a padding/filler for a stack</i>

|Address|Value|
|-------------|-------------|
|0x000000000014FE08|<mark>0000000140001349</mark> -> RETURN ADDRESS to `CallASubroutine1.exe!invoke_main(void)`|
|0x000000000014FE00|16-byte-stack-alignment-padding|
|0x000000000014FDF8|r9-shadow-store|
|0x000000000014FDF0|r8-shadow-store|
|0x000000000014FDE8|rdx-shadow-store|
|0x000000000014FDE0|rcx-shadow-store|
|0x000000000014FDD8|<mark>0000000140001019</mark> -> RETURN ADDRESS to `CallASubroutine1.exe!main(...)`|

## Breaking down each statements

<i>By setting the breakpoint at `main()`, the current RSP <mark>000000000014FE08</mark> contains an address value which returns back to `CallASubroutine1.exe!invoke_main(void)`.</i>

### Frame 1: CallASubroutine1.exe!main(...)

`sub rsp, 28h`
 - `rsp`: 000000000014FE08 - 28 = <mark>000000000014FDE0</mark>

`call func 0140001000h`
 - Proceeds to `CallASubroutine1.exe!func(...)`
 - Adds a return address on <mark>000000000014FDE0</mark>
 - `rsp`: 000000000014FDE0 - 8  = <mark>000000000014FDD8</mark>

`add rsp, 28h`
 - `rsp`: 000000000014FDE0 + 28 = <mark>000000000014FE08</mark>

 `ret`
  - Returns and continues the statement at `CallASubroutine1.exe!invoke_main(void)`
  - `rsp`: 000000000014FE08 + 8 = <mark>000000000014FE10</mark>
<hr>

### Frame 2: CallASubroutine1.exe!func(...)

`mov eax, 0BEEFh`
 - Moves `0xbeef` to `rax` register

 `ret`
  - Returns and continues the statement at `CallASubroutine1.exe!main(...)`
  - `rsp`: 000000000014FDD8 + 8 = <mark>000000000014FDE0</mark>

## Notes to keep in mind

`mov eax, 0BEEFh`
 - `eax` - this would just extend the 64 bit (RAX Register) with zeroes. E.g. ``00000000`0000BEEF``

`ret`
 - Stack always store a return address value in `rsp` when a call function is executed from the statement.
<hr>